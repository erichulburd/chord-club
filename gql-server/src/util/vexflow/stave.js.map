{"version":3,"sources":["../../../node_modules/vexflow/src/stave.js"],"names":["Stave","Element","constructor","x","y","width","options","setAttribute","formatted","start_x","end_x","modifiers","measure","clef","endClef","undefined","font","family","size","weight","vertical_bar_width","glyph_spacing_px","num_lines","fill_style","left_bar","right_bar","spacing_between_lines_px","space_above_staff_ln","space_below_staff_ln","top_text_position","bounds","w","h","Vex","Merge","resetLines","BARTYPE","Barline","type","addModifier","SINGLE","NONE","addEndModifier","space","spacing","line_config","i","push","visible","height","bottom_text_position","getOptions","setNoteStartX","format","begBarline","setX","getWidth","getNoteStartX","getNoteEndX","getTieStartX","getTieEndX","getX","getNumLines","setNumLines","lines","parseInt","setY","getTopLineTopY","getYForLine","Flow","STAVE_LINE_THICKNESS","getBottomLineBottomY","shift","length","mod","setWidth","getStyle","fillStyle","strokeStyle","lineWidth","style","setMeasure","getModifierXShift","index","RERR","getModifiers","StaveModifier","Position","BEGIN","getType","REPEAT_BEGIN","setRepetitionTypeLeft","Repetition","setRepetitionTypeRight","setVoltaType","number_t","Volta","setSection","section","StaveSection","setTempo","tempo","StaveTempo","setText","text","position","StaveText","getHeight","getSpacingBetweenLines","getBoundingBox","BoundingBox","getBottomY","score_bottom","getBottomLineY","line","headroom","getLineForY","getYForTopText","l","getYForBottomText","getYForNote","getYForGlyphs","modifier","setPosition","setStave","END","setBegBarType","setType","setEndBarType","setClef","clefSpec","annotation","clefs","Clef","CATEGORY","addClef","setEndClef","setKeySignature","keySpec","cancelKeySpec","keySignatures","KeySignature","addKeySignature","setKeySig","setEndKeySignature","setTimeSignature","timeSpec","customPadding","timeSignatures","TimeSignature","addTimeSignature","setTimeSig","setEndTimeSignature","addEndClef","addEndTimeSignature","addTrebleGlyph","category","filter","getPosition","getCategory","sortByCategory","items","order","j","temp","endBarline","begModifiers","endModifiers","barlines","keysignatures","timesignatures","splice","indexOf","padding","offset","getPadding","widths","left","right","paddingRight","paddingLeft","lastBarlineIdx","layoutMetrics","getLayoutMetrics","xMax","xMin","draw","checkContext","setRendered","applyStyle","context","beginPath","moveTo","lineTo","stroke","restoreStyle","save","setFont","text_width","measureText","fillText","restore","drawVertical","isDouble","drawVerticalFixed","top_line","bottom_line","fillRect","drawVerticalBar","drawVerticalBarFixed","getConfigForLines","setConfigForLine","line_number","setConfigForLines","lines_configuration"],"mappings":";;;;;;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAfA;AAiBO,MAAMA,KAAN,SAAoBC,gBAApB,CAA4B;AACjCC,EAAAA,WAAW,CAACC,CAAD,EAAIC,CAAJ,EAAOC,KAAP,EAAcC,OAAd,EAAuB;AAChC;AACA,SAAKC,YAAL,CAAkB,MAAlB,EAA0B,OAA1B;AAEA,SAAKJ,CAAL,GAASA,CAAT;AACA,SAAKC,CAAL,GAASA,CAAT;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKG,SAAL,GAAiB,KAAjB;AACA,SAAKC,OAAL,GAAeN,CAAC,GAAG,CAAnB;AACA,SAAKO,KAAL,GAAaP,CAAC,GAAGE,KAAjB;AACA,SAAKM,SAAL,GAAiB,EAAjB,CAVgC,CAUV;;AACtB,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,IAAL,GAAY,QAAZ;AACA,SAAKC,OAAL,GAAeC,SAAf;AACA,SAAKC,IAAL,GAAY;AACVC,MAAAA,MAAM,EAAE,YADE;AAEVC,MAAAA,IAAI,EAAE,CAFI;AAGVC,MAAAA,MAAM,EAAE;AAHE,KAAZ;AAKA,SAAKb,OAAL,GAAe;AACbc,MAAAA,kBAAkB,EAAE,EADP;AACiB;AAC9BC,MAAAA,gBAAgB,EAAE,EAFL;AAGbC,MAAAA,SAAS,EAAE,CAHE;AAIbC,MAAAA,UAAU,EAAE,SAJC;AAKbC,MAAAA,QAAQ,EAAE,IALG;AAKiB;AAC9BC,MAAAA,SAAS,EAAE,IANE;AAMkB;AAC/BC,MAAAA,wBAAwB,EAAE,EAPb;AAOiB;AAC9BC,MAAAA,oBAAoB,EAAE,CART;AAQiB;AAC9BC,MAAAA,oBAAoB,EAAE,CATT;AASiB;AAC9BC,MAAAA,iBAAiB,EAAE,CAVN,CAUkB;;AAVlB,KAAf;AAYA,SAAKC,MAAL,GAAc;AAAE3B,MAAAA,CAAC,EAAE,KAAKA,CAAV;AAAaC,MAAAA,CAAC,EAAE,KAAKA,CAArB;AAAwB2B,MAAAA,CAAC,EAAE,KAAK1B,KAAhC;AAAuC2B,MAAAA,CAAC,EAAE;AAA1C,KAAd;;AACAC,aAAIC,KAAJ,CAAU,KAAK5B,OAAf,EAAwBA,OAAxB;;AAEA,SAAK6B,UAAL;AAEA,UAAMC,OAAO,GAAGC,sBAAQC,IAAxB,CApCgC,CAqChC;;AACA,SAAKC,WAAL,CAAiB,IAAIF,qBAAJ,CAAY,KAAK/B,OAAL,CAAakB,QAAb,GAAwBY,OAAO,CAACI,MAAhC,GAAyCJ,OAAO,CAACK,IAA7D,CAAjB,EAtCgC,CAuChC;;AACA,SAAKC,cAAL,CAAoB,IAAIL,qBAAJ,CAAY,KAAK/B,OAAL,CAAamB,SAAb,GAAyBW,OAAO,CAACI,MAAjC,GAA0CJ,OAAO,CAACK,IAA9D,CAApB;AACD;;AAEDE,EAAAA,KAAK,CAACC,OAAD,EAAU;AAAE,WAAO,KAAKtC,OAAL,CAAaoB,wBAAb,GAAwCkB,OAA/C;AAAyD;;AAE1ET,EAAAA,UAAU,GAAG;AACX,SAAK7B,OAAL,CAAauC,WAAb,GAA2B,EAA3B;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKxC,OAAL,CAAagB,SAAjC,EAA4CwB,CAAC,EAA7C,EAAiD;AAC/C,WAAKxC,OAAL,CAAauC,WAAb,CAAyBE,IAAzB,CAA8B;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAA9B;AACD;;AACD,SAAKC,MAAL,GAAc,CAAC,KAAK3C,OAAL,CAAagB,SAAb,GAAyB,KAAKhB,OAAL,CAAaqB,oBAAvC,IACZ,KAAKrB,OAAL,CAAaoB,wBADf;AAEA,SAAKpB,OAAL,CAAa4C,oBAAb,GAAoC,KAAK5C,OAAL,CAAagB,SAAjD;AACD;;AAED6B,EAAAA,UAAU,GAAG;AAAE,WAAO,KAAK7C,OAAZ;AAAsB;;AAErC8C,EAAAA,aAAa,CAACjD,CAAD,EAAI;AACf,QAAI,CAAC,KAAKK,SAAV,EAAqB,KAAK6C,MAAL;AAErB,SAAK5C,OAAL,GAAeN,CAAf;AACA,UAAMmD,UAAU,GAAG,KAAK3C,SAAL,CAAe,CAAf,CAAnB;AACA2C,IAAAA,UAAU,CAACC,IAAX,CAAgB,KAAK9C,OAAL,GAAe6C,UAAU,CAACE,QAAX,EAA/B;AACA,WAAO,IAAP;AACD;;AACDC,EAAAA,aAAa,GAAG;AACd,QAAI,CAAC,KAAKjD,SAAV,EAAqB,KAAK6C,MAAL;AAErB,WAAO,KAAK5C,OAAZ;AACD;;AAEDiD,EAAAA,WAAW,GAAG;AACZ,QAAI,CAAC,KAAKlD,SAAV,EAAqB,KAAK6C,MAAL;AAErB,WAAO,KAAK3C,KAAZ;AACD;;AACDiD,EAAAA,YAAY,GAAG;AAAE,WAAO,KAAKlD,OAAZ;AAAsB;;AACvCmD,EAAAA,UAAU,GAAG;AAAE,WAAO,KAAKzD,CAAL,GAAS,KAAKE,KAArB;AAA6B;;AAC5CwD,EAAAA,IAAI,GAAG;AAAE,WAAO,KAAK1D,CAAZ;AAAgB;;AACzB2D,EAAAA,WAAW,GAAG;AAAE,WAAO,KAAKxD,OAAL,CAAagB,SAApB;AAAgC;;AAChDyC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,SAAK1D,OAAL,CAAagB,SAAb,GAAyB2C,QAAQ,CAACD,KAAD,EAAQ,EAAR,CAAjC;AACA,SAAK7B,UAAL;AACA,WAAO,IAAP;AACD;;AACD+B,EAAAA,IAAI,CAAC9D,CAAD,EAAI;AAAE,SAAKA,CAAL,GAASA,CAAT;AAAY,WAAO,IAAP;AAAc;;AAEpC+D,EAAAA,cAAc,GAAG;AACf,WAAO,KAAKC,WAAL,CAAiB,CAAjB,IAAuBC,aAAKC,oBAAL,GAA4B,CAA1D;AACD;;AACDC,EAAAA,oBAAoB,GAAG;AACrB,WAAO,KAAKH,WAAL,CAAiB,KAAKN,WAAL,KAAqB,CAAtC,IAA4CO,aAAKC,oBAAL,GAA4B,CAA/E;AACD;;AAEDf,EAAAA,IAAI,CAACpD,CAAD,EAAI;AACN,UAAMqE,KAAK,GAAGrE,CAAC,GAAG,KAAKA,CAAvB;AACA,SAAKK,SAAL,GAAiB,KAAjB;AACA,SAAKL,CAAL,GAASA,CAAT;AACA,SAAKM,OAAL,IAAgB+D,KAAhB;AACA,SAAK9D,KAAL,IAAc8D,KAAd;;AACA,SAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnC,SAAL,CAAe8D,MAAnC,EAA2C3B,CAAC,EAA5C,EAAgD;AAC9C,YAAM4B,GAAG,GAAG,KAAK/D,SAAL,CAAemC,CAAf,CAAZ;;AACA,UAAI4B,GAAG,CAACvE,CAAJ,KAAUY,SAAd,EAAyB;AACvB2D,QAAAA,GAAG,CAACvE,CAAJ,IAASqE,KAAT;AACD;AACF;;AACD,WAAO,IAAP;AACD;;AAEDG,EAAAA,QAAQ,CAACtE,KAAD,EAAQ;AACd,SAAKG,SAAL,GAAiB,KAAjB;AACA,SAAKH,KAAL,GAAaA,KAAb;AACA,SAAKK,KAAL,GAAa,KAAKP,CAAL,GAASE,KAAtB,CAHc,CAKd;AACA;;AACA,WAAO,IAAP;AACD;;AAEDmD,EAAAA,QAAQ,GAAG;AACT,WAAO,KAAKnD,KAAZ;AACD;;AAEDuE,EAAAA,QAAQ,GAAG;AACT,WAAO;AACLC,MAAAA,SAAS,EAAE,KAAKvE,OAAL,CAAaiB,UADnB;AAELuD,MAAAA,WAAW,EAAE,KAAKxE,OAAL,CAAaiB,UAFrB;AAEiC;AACtCwD,MAAAA,SAAS,EAAEV,aAAKC,oBAHX;AAGiC,UAAG,KAAKU,KAAL,IAAc,EAAjB;AAHjC,KAAP;AAKD;;AAEDC,EAAAA,UAAU,CAACrE,OAAD,EAAU;AAAE,SAAKA,OAAL,GAAeA,OAAf;AAAwB,WAAO,IAAP;AAAc;AAE5D;;;;;;;;AAMAsE,EAAAA,iBAAiB,CAACC,KAAK,GAAG,CAAT,EAAY;AAC3B,QAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,YAAM,IAAIlD,SAAImD,IAAR,CAAa,cAAb,EAA6B,wBAA7B,CAAN;AACD;;AAED,QAAI,CAAC,KAAK5E,SAAV,EAAqB,KAAK6C,MAAL;;AAErB,QAAI,KAAKgC,YAAL,CAAkBC,6BAAcC,QAAd,CAAuBC,KAAzC,EAAgDf,MAAhD,KAA2D,CAA/D,EAAkE;AAChE,aAAO,CAAP;AACD;;AAED,QAAIhE,OAAO,GAAG,KAAKA,OAAL,GAAe,KAAKN,CAAlC;AACA,UAAMmD,UAAU,GAAG,KAAK3C,SAAL,CAAe,CAAf,CAAnB;;AACA,QAAI2C,UAAU,CAACmC,OAAX,OAAyBpD,sBAAQC,IAAR,CAAaoD,YAAtC,IAAsDjF,OAAO,GAAG6C,UAAU,CAACE,QAAX,EAApE,EAA2F;AACzF/C,MAAAA,OAAO,IAAI6C,UAAU,CAACE,QAAX,EAAX;AACD;;AAED,WAAO/C,OAAP;AACD,GA9JgC,CAgKjC;;;AACAkF,EAAAA,qBAAqB,CAACrD,IAAD,EAAOlC,CAAP,EAAU;AAC7B,SAAKO,SAAL,CAAeoC,IAAf,CAAoB,IAAI6C,2BAAJ,CAAetD,IAAf,EAAqB,KAAKnC,CAA1B,EAA6BC,CAA7B,CAApB;AACA,WAAO,IAAP;AACD;;AAEDyF,EAAAA,sBAAsB,CAACvD,IAAD,EAAOlC,CAAP,EAAU;AAC9B,SAAKO,SAAL,CAAeoC,IAAf,CAAoB,IAAI6C,2BAAJ,CAAetD,IAAf,EAAqB,KAAKnC,CAA1B,EAA6BC,CAA7B,CAApB;AACA,WAAO,IAAP;AACD,GAzKgC,CA2KjC;;;AACA0F,EAAAA,YAAY,CAACxD,IAAD,EAAOyD,QAAP,EAAiB3F,CAAjB,EAAoB;AAC9B,SAAKO,SAAL,CAAeoC,IAAf,CAAoB,IAAIiD,iBAAJ,CAAU1D,IAAV,EAAgByD,QAAhB,EAA0B,KAAK5F,CAA/B,EAAkCC,CAAlC,CAApB;AACA,WAAO,IAAP;AACD,GA/KgC,CAiLjC;;;AACA6F,EAAAA,UAAU,CAACC,OAAD,EAAU9F,CAAV,EAAa;AACrB,SAAKO,SAAL,CAAeoC,IAAf,CAAoB,IAAIoD,0BAAJ,CAAiBD,OAAjB,EAA0B,KAAK/F,CAA/B,EAAkCC,CAAlC,CAApB;AACA,WAAO,IAAP;AACD,GArLgC,CAuLjC;;;AACAgG,EAAAA,QAAQ,CAACC,KAAD,EAAQjG,CAAR,EAAW;AACjB,SAAKO,SAAL,CAAeoC,IAAf,CAAoB,IAAIuD,sBAAJ,CAAeD,KAAf,EAAsB,KAAKlG,CAA3B,EAA8BC,CAA9B,CAApB;AACA,WAAO,IAAP;AACD,GA3LgC,CA6LjC;;;AACAmG,EAAAA,OAAO,CAACC,IAAD,EAAOC,QAAP,EAAiBnG,OAAjB,EAA0B;AAC/B,SAAKK,SAAL,CAAeoC,IAAf,CAAoB,IAAI2D,oBAAJ,CAAcF,IAAd,EAAoBC,QAApB,EAA8BnG,OAA9B,CAApB;AACA,WAAO,IAAP;AACD;;AAEDqG,EAAAA,SAAS,GAAG;AACV,WAAO,KAAK1D,MAAZ;AACD;;AAED2D,EAAAA,sBAAsB,GAAG;AACvB,WAAO,KAAKtG,OAAL,CAAaoB,wBAApB;AACD;;AAEDmF,EAAAA,cAAc,GAAG;AACf,WAAO,IAAIC,wBAAJ,CAAgB,KAAK3G,CAArB,EAAwB,KAAKC,CAA7B,EAAgC,KAAKC,KAArC,EAA4C,KAAK0G,UAAL,KAAoB,KAAK3G,CAArE,CAAP;AACD;;AAED2G,EAAAA,UAAU,GAAG;AACX,UAAMzG,OAAO,GAAG,KAAKA,OAArB;AACA,UAAMsC,OAAO,GAAGtC,OAAO,CAACoB,wBAAxB;AACA,UAAMsF,YAAY,GAAG,KAAK5C,WAAL,CAAiB9D,OAAO,CAACgB,SAAzB,IAClBhB,OAAO,CAACsB,oBAAR,GAA+BgB,OADlC;AAGA,WAAOoE,YAAP;AACD;;AAEDC,EAAAA,cAAc,GAAG;AACf,WAAO,KAAK7C,WAAL,CAAiB,KAAK9D,OAAL,CAAagB,SAA9B,CAAP;AACD,GA1NgC,CA4NjC;;;AACA8C,EAAAA,WAAW,CAAC8C,IAAD,EAAO;AAChB,UAAM5G,OAAO,GAAG,KAAKA,OAArB;AACA,UAAMsC,OAAO,GAAGtC,OAAO,CAACoB,wBAAxB;AACA,UAAMyF,QAAQ,GAAG7G,OAAO,CAACqB,oBAAzB;AAEA,UAAMvB,CAAC,GAAG,KAAKA,CAAL,GAAU8G,IAAI,GAAGtE,OAAjB,GAA6BuE,QAAQ,GAAGvE,OAAlD;AAEA,WAAOxC,CAAP;AACD;;AAEDgH,EAAAA,WAAW,CAAChH,CAAD,EAAI;AACb;AACA;AAEA,UAAME,OAAO,GAAG,KAAKA,OAArB;AACA,UAAMsC,OAAO,GAAGtC,OAAO,CAACoB,wBAAxB;AACA,UAAMyF,QAAQ,GAAG7G,OAAO,CAACqB,oBAAzB;AACA,WAAQ,CAACvB,CAAC,GAAG,KAAKA,CAAV,IAAewC,OAAhB,GAA2BuE,QAAlC;AACD;;AAEDE,EAAAA,cAAc,CAACH,IAAD,EAAO;AACnB,UAAMI,CAAC,GAAGJ,IAAI,IAAI,CAAlB;AACA,WAAO,KAAK9C,WAAL,CAAiB,CAACkD,CAAD,GAAK,KAAKhH,OAAL,CAAauB,iBAAnC,CAAP;AACD;;AAED0F,EAAAA,iBAAiB,CAACL,IAAD,EAAO;AACtB,UAAMI,CAAC,GAAGJ,IAAI,IAAI,CAAlB;AACA,WAAO,KAAK9C,WAAL,CAAiB,KAAK9D,OAAL,CAAa4C,oBAAb,GAAoCoE,CAArD,CAAP;AACD;;AAEDE,EAAAA,WAAW,CAACN,IAAD,EAAO;AAChB,UAAM5G,OAAO,GAAG,KAAKA,OAArB;AACA,UAAMsC,OAAO,GAAGtC,OAAO,CAACoB,wBAAxB;AACA,UAAMyF,QAAQ,GAAG7G,OAAO,CAACqB,oBAAzB;AACA,UAAMvB,CAAC,GAAG,KAAKA,CAAL,GAAU+G,QAAQ,GAAGvE,OAArB,GAAiC,IAAIA,OAArC,GAAiDsE,IAAI,GAAGtE,OAAlE;AAEA,WAAOxC,CAAP;AACD;;AAEDqH,EAAAA,aAAa,GAAG;AACd,WAAO,KAAKrD,WAAL,CAAiB,CAAjB,CAAP;AACD,GAtQgC,CAwQjC;AACA;;;AACA7B,EAAAA,WAAW,CAACmF,QAAD,EAAWjB,QAAX,EAAqB;AAC9B,QAAIA,QAAQ,KAAK1F,SAAjB,EAA4B;AAC1B2G,MAAAA,QAAQ,CAACC,WAAT,CAAqBlB,QAArB;AACD;;AAEDiB,IAAAA,QAAQ,CAACE,QAAT,CAAkB,IAAlB;AACA,SAAKpH,SAAL,GAAiB,KAAjB;AACA,SAAKG,SAAL,CAAeoC,IAAf,CAAoB2E,QAApB;AACA,WAAO,IAAP;AACD;;AAEDhF,EAAAA,cAAc,CAACgF,QAAD,EAAW;AACvB,SAAKnF,WAAL,CAAiBmF,QAAjB,EAA2BpC,6BAAcC,QAAd,CAAuBsC,GAAlD;AACA,WAAO,IAAP;AACD,GAxRgC,CA0RjC;;;AACAC,EAAAA,aAAa,CAACxF,IAAD,EAAO;AAClB;AACA,UAAM;AAAEE,MAAAA,MAAF;AAAUkD,MAAAA,YAAV;AAAwBjD,MAAAA;AAAxB,QAAiCJ,sBAAQC,IAA/C;;AACA,QAAIA,IAAI,KAAKE,MAAT,IAAmBF,IAAI,KAAKoD,YAA5B,IAA4CpD,IAAI,KAAKG,IAAzD,EAA+D;AAC7D,WAAK9B,SAAL,CAAe,CAAf,EAAkBoH,OAAlB,CAA0BzF,IAA1B;AACA,WAAK9B,SAAL,GAAiB,KAAjB;AACD;;AACD,WAAO,IAAP;AACD;;AAEDwH,EAAAA,aAAa,CAAC1F,IAAD,EAAO;AAClB;AACA,QAAIA,IAAI,KAAKD,sBAAQC,IAAR,CAAaoD,YAA1B,EAAwC;AACtC,WAAK/E,SAAL,CAAe,CAAf,EAAkBoH,OAAlB,CAA0BzF,IAA1B;AACA,WAAK9B,SAAL,GAAiB,KAAjB;AACD;;AACD,WAAO,IAAP;AACD;;AAEDyH,EAAAA,OAAO,CAACC,QAAD,EAAWhH,IAAX,EAAiBiH,UAAjB,EAA6B1B,QAA7B,EAAuC;AAC5C,QAAIA,QAAQ,KAAK1F,SAAjB,EAA4B;AAC1B0F,MAAAA,QAAQ,GAAGnB,6BAAcC,QAAd,CAAuBC,KAAlC;AACD;;AAED,QAAIiB,QAAQ,KAAKnB,6BAAcC,QAAd,CAAuBsC,GAAxC,EAA6C;AAC3C,WAAK/G,OAAL,GAAeoH,QAAf;AACD,KAFD,MAEO;AACL,WAAKrH,IAAL,GAAYqH,QAAZ;AACD;;AAED,UAAME,KAAK,GAAG,KAAK/C,YAAL,CAAkBoB,QAAlB,EAA4B4B,WAAKC,QAAjC,CAAd;;AACA,QAAIF,KAAK,CAAC3D,MAAN,KAAiB,CAArB,EAAwB;AACtB,WAAK8D,OAAL,CAAaL,QAAb,EAAuBhH,IAAvB,EAA6BiH,UAA7B,EAAyC1B,QAAzC;AACD,KAFD,MAEO;AACL2B,MAAAA,KAAK,CAAC,CAAD,CAAL,CAASL,OAAT,CAAiBG,QAAjB,EAA2BhH,IAA3B,EAAiCiH,UAAjC;AACD;;AAED,WAAO,IAAP;AACD;;AAEDK,EAAAA,UAAU,CAACN,QAAD,EAAWhH,IAAX,EAAiBiH,UAAjB,EAA6B;AACrC,SAAKF,OAAL,CAAaC,QAAb,EAAuBhH,IAAvB,EAA6BiH,UAA7B,EAAyC7C,6BAAcC,QAAd,CAAuBsC,GAAhE;AACA,WAAO,IAAP;AACD;;AAEDY,EAAAA,eAAe,CAACC,OAAD,EAAUC,aAAV,EAAyBlC,QAAzB,EAAmC;AAChD,QAAIA,QAAQ,KAAK1F,SAAjB,EAA4B;AAC1B0F,MAAAA,QAAQ,GAAGnB,6BAAcC,QAAd,CAAuBC,KAAlC;AACD;;AAED,UAAMoD,aAAa,GAAG,KAAKvD,YAAL,CAAkBoB,QAAlB,EAA4BoC,2BAAaP,QAAzC,CAAtB;;AACA,QAAIM,aAAa,CAACnE,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,WAAKqE,eAAL,CAAqBJ,OAArB,EAA8BC,aAA9B,EAA6ClC,QAA7C;AACD,KAFD,MAEO;AACLmC,MAAAA,aAAa,CAAC,CAAD,CAAb,CAAiBG,SAAjB,CAA2BL,OAA3B,EAAoCC,aAApC;AACD;;AAED,WAAO,IAAP;AACD;;AAEDK,EAAAA,kBAAkB,CAACN,OAAD,EAAUC,aAAV,EAAyB;AACzC,SAAKF,eAAL,CAAqBC,OAArB,EAA8BC,aAA9B,EAA6CrD,6BAAcC,QAAd,CAAuBsC,GAApE;AACA,WAAO,IAAP;AACD;;AAEDoB,EAAAA,gBAAgB,CAACC,QAAD,EAAWC,aAAX,EAA0B1C,QAA1B,EAAoC;AAClD,QAAIA,QAAQ,KAAK1F,SAAjB,EAA4B;AAC1B0F,MAAAA,QAAQ,GAAGnB,6BAAcC,QAAd,CAAuBC,KAAlC;AACD;;AAED,UAAM4D,cAAc,GAAG,KAAK/D,YAAL,CAAkBoB,QAAlB,EAA4B4C,6BAAcf,QAA1C,CAAvB;;AACA,QAAIc,cAAc,CAAC3E,MAAf,KAA0B,CAA9B,EAAiC;AAC/B,WAAK6E,gBAAL,CAAsBJ,QAAtB,EAAgCC,aAAhC,EAA+C1C,QAA/C;AACD,KAFD,MAEO;AACL2C,MAAAA,cAAc,CAAC,CAAD,CAAd,CAAkBG,UAAlB,CAA6BL,QAA7B;AACD;;AAED,WAAO,IAAP;AACD;;AAEDM,EAAAA,mBAAmB,CAACN,QAAD,EAAWC,aAAX,EAA0B;AAC3C,SAAKF,gBAAL,CAAsBC,QAAtB,EAAgCC,aAAhC,EAA+C7D,6BAAcC,QAAd,CAAuBsC,GAAtE;AACA,WAAO,IAAP;AACD;;AAEDiB,EAAAA,eAAe,CAACJ,OAAD,EAAUC,aAAV,EAAyBlC,QAAzB,EAAmC;AAChD,QAAIA,QAAQ,KAAK1F,SAAjB,EAA4B;AAC1B0F,MAAAA,QAAQ,GAAGnB,6BAAcC,QAAd,CAAuBC,KAAlC;AACD;;AACD,SAAKjD,WAAL,CAAiB,IAAIsG,0BAAJ,CAAiBH,OAAjB,EAA0BC,aAA1B,EACdhB,WADc,CACFlB,QADE,CAAjB,EAC0BA,QAD1B;AAEA,WAAO,IAAP;AACD;;AAED8B,EAAAA,OAAO,CAAC1H,IAAD,EAAOK,IAAP,EAAaiH,UAAb,EAAyB1B,QAAzB,EAAmC;AACxC,QAAIA,QAAQ,KAAK1F,SAAb,IAA0B0F,QAAQ,KAAKnB,6BAAcC,QAAd,CAAuBC,KAAlE,EAAyE;AACvE,WAAK3E,IAAL,GAAYA,IAAZ;AACD,KAFD,MAEO,IAAI4F,QAAQ,KAAKnB,6BAAcC,QAAd,CAAuBsC,GAAxC,EAA6C;AAClD,WAAK/G,OAAL,GAAeD,IAAf;AACD;;AAED,SAAK0B,WAAL,CAAiB,IAAI8F,UAAJ,CAASxH,IAAT,EAAeK,IAAf,EAAqBiH,UAArB,CAAjB,EAAmD1B,QAAnD;AACA,WAAO,IAAP;AACD;;AAEDgD,EAAAA,UAAU,CAAC5I,IAAD,EAAOK,IAAP,EAAaiH,UAAb,EAAyB;AACjC,SAAKI,OAAL,CAAa1H,IAAb,EAAmBK,IAAnB,EAAyBiH,UAAzB,EAAqC7C,6BAAcC,QAAd,CAAuBsC,GAA5D;AACA,WAAO,IAAP;AACD;;AAEDyB,EAAAA,gBAAgB,CAACJ,QAAD,EAAWC,aAAX,EAA0B1C,QAA1B,EAAoC;AAClD,SAAKlE,WAAL,CAAiB,IAAI8G,4BAAJ,CAAkBH,QAAlB,EAA4BC,aAA5B,CAAjB,EAA6D1C,QAA7D;AACA,WAAO,IAAP;AACD;;AAEDiD,EAAAA,mBAAmB,CAACR,QAAD,EAAWC,aAAX,EAA0B;AAC3C,SAAKG,gBAAL,CAAsBJ,QAAtB,EAAgCC,aAAhC,EAA+C7D,6BAAcC,QAAd,CAAuBsC,GAAtE;AACA,WAAO,IAAP;AACD,GAjZgC,CAmZjC;;;AACA8B,EAAAA,cAAc,GAAG;AACf,SAAKpB,OAAL,CAAa,QAAb;AACA,WAAO,IAAP;AACD;;AAEDlD,EAAAA,YAAY,CAACoB,QAAD,EAAWmD,QAAX,EAAqB;AAC/B,QAAInD,QAAQ,KAAK1F,SAAb,IAA0B6I,QAAQ,KAAK7I,SAA3C,EAAsD,OAAO,KAAKJ,SAAZ;AAEtD,WAAO,KAAKA,SAAL,CAAekJ,MAAf,CAAsBnC,QAAQ,IACnC,CAACjB,QAAQ,KAAK1F,SAAb,IAA0B0F,QAAQ,KAAKiB,QAAQ,CAACoC,WAAT,EAAxC,MACCF,QAAQ,KAAK7I,SAAb,IAA0B6I,QAAQ,KAAKlC,QAAQ,CAACqC,WAAT,EADxC,CADK,CAAP;AAID;;AAEDC,EAAAA,cAAc,CAACC,KAAD,EAAQC,KAAR,EAAe;AAC3B,SAAK,IAAIpH,CAAC,GAAGmH,KAAK,CAACxF,MAAN,GAAe,CAA5B,EAA+B3B,CAAC,IAAI,CAApC,EAAuCA,CAAC,EAAxC,EAA4C;AAC1C,WAAK,IAAIqH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrH,CAApB,EAAuBqH,CAAC,EAAxB,EAA4B;AAC1B,YAAID,KAAK,CAACD,KAAK,CAACE,CAAD,CAAL,CAASJ,WAAT,EAAD,CAAL,GAAgCG,KAAK,CAACD,KAAK,CAACE,CAAC,GAAG,CAAL,CAAL,CAAaJ,WAAb,EAAD,CAAzC,EAAuE;AACrE,gBAAMK,IAAI,GAAGH,KAAK,CAACE,CAAD,CAAlB;AACAF,UAAAA,KAAK,CAACE,CAAD,CAAL,GAAWF,KAAK,CAACE,CAAC,GAAG,CAAL,CAAhB;AACAF,UAAAA,KAAK,CAACE,CAAC,GAAG,CAAL,CAAL,GAAeC,IAAf;AACD;AACF;AACF;AACF;;AAED/G,EAAAA,MAAM,GAAG;AACP,UAAMC,UAAU,GAAG,KAAK3C,SAAL,CAAe,CAAf,CAAnB;AACA,UAAM0J,UAAU,GAAG,KAAK1J,SAAL,CAAe,CAAf,CAAnB;AAEA,UAAM2J,YAAY,GAAG,KAAKjF,YAAL,CAAkBC,6BAAcC,QAAd,CAAuBC,KAAzC,CAArB;AACA,UAAM+E,YAAY,GAAG,KAAKlF,YAAL,CAAkBC,6BAAcC,QAAd,CAAuBsC,GAAzC,CAArB;AAEA,SAAKmC,cAAL,CAAoBM,YAApB,EAAkC;AAChCE,MAAAA,QAAQ,EAAE,CADsB;AACnBpC,MAAAA,KAAK,EAAE,CADY;AACTqC,MAAAA,aAAa,EAAE,CADN;AACSC,MAAAA,cAAc,EAAE;AADzB,KAAlC;AAIA,SAAKV,cAAL,CAAoBO,YAApB,EAAkC;AAChCG,MAAAA,cAAc,EAAE,CADgB;AACbD,MAAAA,aAAa,EAAE,CADF;AACKD,MAAAA,QAAQ,EAAE,CADf;AACkBpC,MAAAA,KAAK,EAAE;AADzB,KAAlC;;AAIA,QAAIkC,YAAY,CAAC7F,MAAb,GAAsB,CAAtB,IACFnB,UAAU,CAACmC,OAAX,OAAyBpD,sBAAQC,IAAR,CAAaoD,YADxC,EACsD;AACpD4E,MAAAA,YAAY,CAACvH,IAAb,CAAkBuH,YAAY,CAACK,MAAb,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAA1B,CAAlB;AACAL,MAAAA,YAAY,CAACK,MAAb,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,IAAItI,qBAAJ,CAAYA,sBAAQC,IAAR,CAAaE,MAAzB,CAA1B;AACD;;AAED,QAAI+H,YAAY,CAACK,OAAb,CAAqBP,UAArB,IAAmC,CAAvC,EAA0C;AACxCE,MAAAA,YAAY,CAACI,MAAb,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,IAAItI,qBAAJ,CAAYA,sBAAQC,IAAR,CAAaG,IAAzB,CAA1B;AACD;;AAED,QAAIpC,KAAJ;AACA,QAAIwK,OAAJ;AACA,QAAInD,QAAJ;AACA,QAAIoD,MAAM,GAAG,CAAb;AACA,QAAI3K,CAAC,GAAG,KAAKA,CAAb;;AACA,SAAK,IAAI2C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwH,YAAY,CAAC7F,MAAjC,EAAyC3B,CAAC,EAA1C,EAA8C;AAC5C4E,MAAAA,QAAQ,GAAG4C,YAAY,CAACxH,CAAD,CAAvB;AACA+H,MAAAA,OAAO,GAAGnD,QAAQ,CAACqD,UAAT,CAAoBjI,CAAC,GAAGgI,MAAxB,CAAV;AACAzK,MAAAA,KAAK,GAAGqH,QAAQ,CAAClE,QAAT,EAAR;AAEArD,MAAAA,CAAC,IAAI0K,OAAL;AACAnD,MAAAA,QAAQ,CAACnE,IAAT,CAAcpD,CAAd;AACAA,MAAAA,CAAC,IAAIE,KAAL;AAEA,UAAIwK,OAAO,GAAGxK,KAAV,KAAoB,CAAxB,EAA2ByK,MAAM;AAClC;;AAED,SAAKrK,OAAL,GAAeN,CAAf;AACAA,IAAAA,CAAC,GAAG,KAAKA,CAAL,GAAS,KAAKE,KAAlB;AAEA,UAAM2K,MAAM,GAAG;AACbC,MAAAA,IAAI,EAAE,CADO;AAEbC,MAAAA,KAAK,EAAE,CAFM;AAGbC,MAAAA,YAAY,EAAE,CAHD;AAIbC,MAAAA,WAAW,EAAE;AAJA,KAAf;AAOA,QAAIC,cAAc,GAAG,CAArB;;AAEA,SAAK,IAAIvI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyH,YAAY,CAAC9F,MAAjC,EAAyC3B,CAAC,EAA1C,EAA8C;AAC5C4E,MAAAA,QAAQ,GAAG6C,YAAY,CAACzH,CAAD,CAAvB;AACAuI,MAAAA,cAAc,GAAI3D,QAAQ,CAACqC,WAAT,OAA2B,UAA5B,GAA0CjH,CAA1C,GAA8CuI,cAA/D;AAEAL,MAAAA,MAAM,CAACE,KAAP,GAAe,CAAf;AACAF,MAAAA,MAAM,CAACC,IAAP,GAAc,CAAd;AACAD,MAAAA,MAAM,CAACG,YAAP,GAAsB,CAAtB;AACAH,MAAAA,MAAM,CAACI,WAAP,GAAqB,CAArB;AACA,YAAME,aAAa,GAAG5D,QAAQ,CAAC6D,gBAAT,EAAtB;;AAEA,UAAID,aAAJ,EAAmB;AACjB,YAAIxI,CAAC,KAAK,CAAV,EAAa;AACXkI,UAAAA,MAAM,CAACE,KAAP,GAAeI,aAAa,CAACE,IAAd,IAAsB,CAArC;AACAR,UAAAA,MAAM,CAACG,YAAP,GAAsBG,aAAa,CAACH,YAAd,IAA8B,CAApD;AACD;;AACDH,QAAAA,MAAM,CAACC,IAAP,GAAe,CAACK,aAAa,CAACG,IAAhB,IAAyB,CAAvC;AACAT,QAAAA,MAAM,CAACI,WAAP,GAAqBE,aAAa,CAACF,WAAd,IAA6B,CAAlD;;AAEA,YAAItI,CAAC,KAAKyH,YAAY,CAAC9F,MAAb,GAAsB,CAAhC,EAAmC;AACjCuG,UAAAA,MAAM,CAACI,WAAP,GAAqB,CAArB;AACD;AACF,OAXD,MAWO;AACLJ,QAAAA,MAAM,CAACG,YAAP,GAAsBzD,QAAQ,CAACqD,UAAT,CAAoBjI,CAAC,GAAGuI,cAAxB,CAAtB;;AACA,YAAIvI,CAAC,KAAK,CAAV,EAAa;AACXkI,UAAAA,MAAM,CAACE,KAAP,GAAexD,QAAQ,CAAClE,QAAT,EAAf;AACD;;AACD,YAAIV,CAAC,KAAK,CAAV,EAAa;AACXkI,UAAAA,MAAM,CAACC,IAAP,GAAcvD,QAAQ,CAAClE,QAAT,EAAd;AACD;AACF;;AACDrD,MAAAA,CAAC,IAAI6K,MAAM,CAACG,YAAZ;AACAhL,MAAAA,CAAC,IAAI6K,MAAM,CAACE,KAAZ;AAEAxD,MAAAA,QAAQ,CAACnE,IAAT,CAAcpD,CAAd;AAEAA,MAAAA,CAAC,IAAI6K,MAAM,CAACC,IAAZ;AACA9K,MAAAA,CAAC,IAAI6K,MAAM,CAACI,WAAZ;AACD;;AAED,SAAK1K,KAAL,GAAa6J,YAAY,CAAC9F,MAAb,KAAwB,CAAxB,GAA4B,KAAKtE,CAAL,GAAS,KAAKE,KAA1C,GAAkDF,CAA/D;AACA,SAAKK,SAAL,GAAiB,IAAjB;AACD;AAED;;;;;AAGAkL,EAAAA,IAAI,GAAG;AACL,SAAKC,YAAL;AACA,SAAKC,WAAL;AAEA,QAAI,CAAC,KAAKpL,SAAV,EAAqB,KAAK6C,MAAL;AAErB,UAAM/B,SAAS,GAAG,KAAKhB,OAAL,CAAagB,SAA/B;AACA,UAAMjB,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMF,CAAC,GAAG,KAAKA,CAAf;AACA,QAAIC,CAAJ,CATK,CAWL;;AACA,SAAK,IAAI8G,IAAI,GAAG,CAAhB,EAAmBA,IAAI,GAAG5F,SAA1B,EAAqC4F,IAAI,EAAzC,EAA6C;AAC3C9G,MAAAA,CAAC,GAAG,KAAKgE,WAAL,CAAiB8C,IAAjB,CAAJ;AAEA,WAAK2E,UAAL;;AACA,UAAI,KAAKvL,OAAL,CAAauC,WAAb,CAAyBqE,IAAzB,EAA+BlE,OAAnC,EAA4C;AAC1C,aAAK8I,OAAL,CAAaC,SAAb;AACA,aAAKD,OAAL,CAAaE,MAAb,CAAoB7L,CAApB,EAAuBC,CAAvB;AACA,aAAK0L,OAAL,CAAaG,MAAb,CAAoB9L,CAAC,GAAGE,KAAxB,EAA+BD,CAA/B;AACA,aAAK0L,OAAL,CAAaI,MAAb;AACD;;AACD,WAAKC,YAAL;AACD,KAvBI,CAyBL;;;AACA,SAAK,IAAIrJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKnC,SAAL,CAAe8D,MAAnC,EAA2C3B,CAAC,EAA5C,EAAgD;AAC9C;AACA,UAAI,OAAO,KAAKnC,SAAL,CAAemC,CAAf,EAAkB4I,IAAzB,KAAkC,UAAtC,EAAkD;AAChD,aAAK/K,SAAL,CAAemC,CAAf,EAAkB+I,UAAlB,CAA6B,KAAKC,OAAlC;AACA,aAAKnL,SAAL,CAAemC,CAAf,EAAkB4I,IAAlB,CAAuB,IAAvB,EAA6B,KAAKxG,iBAAL,CAAuBpC,CAAvB,CAA7B;AACA,aAAKnC,SAAL,CAAemC,CAAf,EAAkBqJ,YAAlB,CAA+B,KAAKL,OAApC;AACD;AACF,KAjCI,CAmCL;;;AACA,QAAI,KAAKlL,OAAL,GAAe,CAAnB,EAAsB;AACpB,WAAKkL,OAAL,CAAaM,IAAb;AACA,WAAKN,OAAL,CAAaO,OAAb,CAAqB,KAAKrL,IAAL,CAAUC,MAA/B,EAAuC,KAAKD,IAAL,CAAUE,IAAjD,EAAuD,KAAKF,IAAL,CAAUG,MAAjE;AACA,YAAMmL,UAAU,GAAG,KAAKR,OAAL,CAAaS,WAAb,CAAyB,KAAK,KAAK3L,OAAnC,EAA4CP,KAA/D;AACAD,MAAAA,CAAC,GAAG,KAAKiH,cAAL,CAAoB,CAApB,IAAyB,CAA7B;AACA,WAAKyE,OAAL,CAAaU,QAAb,CAAsB,KAAK,KAAK5L,OAAhC,EAAyC,KAAKT,CAAL,GAASmM,UAAU,GAAG,CAA/D,EAAkElM,CAAlE;AACA,WAAK0L,OAAL,CAAaW,OAAb;AACD;;AAED,WAAO,IAAP;AACD,GAhkBgC,CAkkBjC;AACA;;;AACAC,EAAAA,YAAY,CAACvM,CAAD,EAAIwM,QAAJ,EAAc;AACxB,SAAKC,iBAAL,CAAuB,KAAKzM,CAAL,GAASA,CAAhC,EAAmCwM,QAAnC;AACD;;AAEDC,EAAAA,iBAAiB,CAACzM,CAAD,EAAIwM,QAAJ,EAAc;AAC7B,SAAKhB,YAAL;AAEA,UAAMkB,QAAQ,GAAG,KAAKzI,WAAL,CAAiB,CAAjB,CAAjB;AACA,UAAM0I,WAAW,GAAG,KAAK1I,WAAL,CAAiB,KAAK9D,OAAL,CAAagB,SAAb,GAAyB,CAA1C,CAApB;;AACA,QAAIqL,QAAJ,EAAc;AACZ,WAAKb,OAAL,CAAaiB,QAAb,CAAsB5M,CAAC,GAAG,CAA1B,EAA6B0M,QAA7B,EAAuC,CAAvC,EAA0CC,WAAW,GAAGD,QAAd,GAAyB,CAAnE;AACD;;AACD,SAAKf,OAAL,CAAaiB,QAAb,CAAsB5M,CAAtB,EAAyB0M,QAAzB,EAAmC,CAAnC,EAAsCC,WAAW,GAAGD,QAAd,GAAyB,CAA/D;AACD;;AAEDG,EAAAA,eAAe,CAAC7M,CAAD,EAAI;AACjB,SAAK8M,oBAAL,CAA0B,KAAK9M,CAAL,GAASA,CAAnC,EAAsC,KAAtC;AACD;;AAED8M,EAAAA,oBAAoB,CAAC9M,CAAD,EAAI;AACtB,SAAKwL,YAAL;AAEA,UAAMkB,QAAQ,GAAG,KAAKzI,WAAL,CAAiB,CAAjB,CAAjB;AACA,UAAM0I,WAAW,GAAG,KAAK1I,WAAL,CAAiB,KAAK9D,OAAL,CAAagB,SAAb,GAAyB,CAA1C,CAApB;AACA,SAAKwK,OAAL,CAAaiB,QAAb,CAAsB5M,CAAtB,EAAyB0M,QAAzB,EAAmC,CAAnC,EAAsCC,WAAW,GAAGD,QAAd,GAAyB,CAA/D;AACD;AAED;;;;;;AAIAK,EAAAA,iBAAiB,GAAG;AAClB,WAAO,KAAK5M,OAAL,CAAauC,WAApB;AACD;AAED;;;;;;;;;AAOAsK,EAAAA,gBAAgB,CAACC,WAAD,EAAcvK,WAAd,EAA2B;AACzC,QAAIuK,WAAW,IAAI,KAAK9M,OAAL,CAAagB,SAA5B,IAAyC8L,WAAW,GAAG,CAA3D,EAA8D;AAC5D,YAAM,IAAInL,SAAImD,IAAR,CACJ,kBADI,EAEJ,+EAFI,CAAN;AAID;;AAED,QAAIvC,WAAW,CAACG,OAAZ,KAAwBjC,SAA5B,EAAuC;AACrC,YAAM,IAAIkB,SAAImD,IAAR,CACJ,kBADI,EAEJ,kEAFI,CAAN;AAID;;AAED,QAAI,OAAQvC,WAAW,CAACG,OAApB,KAAiC,SAArC,EAAgD;AAC9C,YAAM,IAAIf,SAAImD,IAAR,CACJ,kBADI,EAEJ,0EAFI,CAAN;AAID;;AAED,SAAK9E,OAAL,CAAauC,WAAb,CAAyBuK,WAAzB,IAAwCvK,WAAxC;AAEA,WAAO,IAAP;AACD;AAED;;;;;;;;;;;AASAwK,EAAAA,iBAAiB,CAACC,mBAAD,EAAsB;AACrC,QAAIA,mBAAmB,CAAC7I,MAApB,KAA+B,KAAKnE,OAAL,CAAagB,SAAhD,EAA2D;AACzD,YAAM,IAAIW,SAAImD,IAAR,CACJ,kBADI,EAEJ,yFAFI,CAAN;AAID,KANoC,CAQrC;AACA;AACA;;;AACA,SAAK,MAAMvC,WAAX,IAA0ByK,mBAA1B,EAA+C;AAC7C;AACA,UAAI,CAACA,mBAAmB,CAACzK,WAAD,CAAxB,EAAuC;AACrCyK,QAAAA,mBAAmB,CAACzK,WAAD,CAAnB,GAAmC,KAAKvC,OAAL,CAAauC,WAAb,CAAyBA,WAAzB,CAAnC;AACD;;AACDZ,eAAIC,KAAJ,CAAU,KAAK5B,OAAL,CAAauC,WAAb,CAAyBA,WAAzB,CAAV,EAAiDyK,mBAAmB,CAACzK,WAAD,CAApE;AACD;;AAED,SAAKvC,OAAL,CAAauC,WAAb,GAA2ByK,mBAA3B;AAEA,WAAO,IAAP;AACD;;AAxqBgC;;QAAtBtN,K,GAAAA,K","sourcesContent":["// [VexFlow](http://vexflow.com) - Copyright (c) Mohit Muthanna 2010.\n\nimport { Vex } from './vex';\nimport { Element } from './element';\nimport { Flow } from './tables';\nimport { Barline } from './stavebarline';\nimport { StaveModifier } from './stavemodifier';\nimport { Repetition } from './staverepetition';\nimport { StaveSection } from './stavesection';\nimport { StaveTempo } from './stavetempo';\nimport { StaveText } from './stavetext';\nimport { BoundingBox } from './boundingbox';\nimport { Clef } from './clef';\nimport { KeySignature } from './keysignature';\nimport { TimeSignature } from './timesignature';\nimport { Volta } from './stavevolta';\n\nexport class Stave extends Element {\n  constructor(x, y, width, options) {\n    super();\n    this.setAttribute('type', 'Stave');\n\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.formatted = false;\n    this.start_x = x + 5;\n    this.end_x = x + width;\n    this.modifiers = [];  // stave modifiers (clef, key, time, barlines, coda, segno, etc.)\n    this.measure = 0;\n    this.clef = 'treble';\n    this.endClef = undefined;\n    this.font = {\n      family: 'sans-serif',\n      size: 8,\n      weight: '',\n    };\n    this.options = {\n      vertical_bar_width: 10,       // Width around vertical bar end-marker\n      glyph_spacing_px: 10,\n      num_lines: 5,\n      fill_style: '#999999',\n      left_bar: true,               // draw vertical bar on left\n      right_bar: true,               // draw vertical bar on right\n      spacing_between_lines_px: 10, // in pixels\n      space_above_staff_ln: 4,      // in staff lines\n      space_below_staff_ln: 4,      // in staff lines\n      top_text_position: 1,          // in staff lines\n    };\n    this.bounds = { x: this.x, y: this.y, w: this.width, h: 0 };\n    Vex.Merge(this.options, options);\n\n    this.resetLines();\n\n    const BARTYPE = Barline.type;\n    // beg bar\n    this.addModifier(new Barline(this.options.left_bar ? BARTYPE.SINGLE : BARTYPE.NONE));\n    // end bar\n    this.addEndModifier(new Barline(this.options.right_bar ? BARTYPE.SINGLE : BARTYPE.NONE));\n  }\n\n  space(spacing) { return this.options.spacing_between_lines_px * spacing; }\n\n  resetLines() {\n    this.options.line_config = [];\n    for (let i = 0; i < this.options.num_lines; i++) {\n      this.options.line_config.push({ visible: true });\n    }\n    this.height = (this.options.num_lines + this.options.space_above_staff_ln) *\n      this.options.spacing_between_lines_px;\n    this.options.bottom_text_position = this.options.num_lines;\n  }\n\n  getOptions() { return this.options; }\n\n  setNoteStartX(x) {\n    if (!this.formatted) this.format();\n\n    this.start_x = x;\n    const begBarline = this.modifiers[0];\n    begBarline.setX(this.start_x - begBarline.getWidth());\n    return this;\n  }\n  getNoteStartX() {\n    if (!this.formatted) this.format();\n\n    return this.start_x;\n  }\n\n  getNoteEndX() {\n    if (!this.formatted) this.format();\n\n    return this.end_x;\n  }\n  getTieStartX() { return this.start_x; }\n  getTieEndX() { return this.x + this.width; }\n  getX() { return this.x; }\n  getNumLines() { return this.options.num_lines; }\n  setNumLines(lines) {\n    this.options.num_lines = parseInt(lines, 10);\n    this.resetLines();\n    return this;\n  }\n  setY(y) { this.y = y; return this; }\n\n  getTopLineTopY() {\n    return this.getYForLine(0) - (Flow.STAVE_LINE_THICKNESS / 2);\n  }\n  getBottomLineBottomY() {\n    return this.getYForLine(this.getNumLines() - 1) + (Flow.STAVE_LINE_THICKNESS / 2);\n  }\n\n  setX(x) {\n    const shift = x - this.x;\n    this.formatted = false;\n    this.x = x;\n    this.start_x += shift;\n    this.end_x += shift;\n    for (let i = 0; i < this.modifiers.length; i++) {\n      const mod = this.modifiers[i];\n      if (mod.x !== undefined) {\n        mod.x += shift;\n      }\n    }\n    return this;\n  }\n\n  setWidth(width) {\n    this.formatted = false;\n    this.width = width;\n    this.end_x = this.x + width;\n\n    // reset the x position of the end barline (TODO(0xfe): This makes no sense)\n    // this.modifiers[1].setX(this.end_x);\n    return this;\n  }\n\n  getWidth() {\n    return this.width;\n  }\n\n  getStyle() {\n    return {\n      fillStyle: this.options.fill_style,\n      strokeStyle: this.options.fill_style, // yes, this is correct for legacy compatibility\n      lineWidth: Flow.STAVE_LINE_THICKNESS, ...this.style || {}\n    };\n  }\n\n  setMeasure(measure) { this.measure = measure; return this; }\n\n  /**\n   * Gets the pixels to shift from the beginning of the stave\n   * following the modifier at the provided index\n   * @param  {Number} index The index from which to determine the shift\n   * @return {Number}       The amount of pixels shifted\n   */\n  getModifierXShift(index = 0) {\n    if (typeof index !== 'number') {\n      throw new Vex.RERR('InvalidIndex', 'Must be of number type');\n    }\n\n    if (!this.formatted) this.format();\n\n    if (this.getModifiers(StaveModifier.Position.BEGIN).length === 1) {\n      return 0;\n    }\n\n    let start_x = this.start_x - this.x;\n    const begBarline = this.modifiers[0];\n    if (begBarline.getType() === Barline.type.REPEAT_BEGIN && start_x > begBarline.getWidth()) {\n      start_x -= begBarline.getWidth();\n    }\n\n    return start_x;\n  }\n\n  // Coda & Segno Symbol functions\n  setRepetitionTypeLeft(type, y) {\n    this.modifiers.push(new Repetition(type, this.x, y));\n    return this;\n  }\n\n  setRepetitionTypeRight(type, y) {\n    this.modifiers.push(new Repetition(type, this.x, y));\n    return this;\n  }\n\n  // Volta functions\n  setVoltaType(type, number_t, y) {\n    this.modifiers.push(new Volta(type, number_t, this.x, y));\n    return this;\n  }\n\n  // Section functions\n  setSection(section, y) {\n    this.modifiers.push(new StaveSection(section, this.x, y));\n    return this;\n  }\n\n  // Tempo functions\n  setTempo(tempo, y) {\n    this.modifiers.push(new StaveTempo(tempo, this.x, y));\n    return this;\n  }\n\n  // Text functions\n  setText(text, position, options) {\n    this.modifiers.push(new StaveText(text, position, options));\n    return this;\n  }\n\n  getHeight() {\n    return this.height;\n  }\n\n  getSpacingBetweenLines() {\n    return this.options.spacing_between_lines_px;\n  }\n\n  getBoundingBox() {\n    return new BoundingBox(this.x, this.y, this.width, this.getBottomY() - this.y);\n  }\n\n  getBottomY() {\n    const options = this.options;\n    const spacing = options.spacing_between_lines_px;\n    const score_bottom = this.getYForLine(options.num_lines) +\n      (options.space_below_staff_ln * spacing);\n\n    return score_bottom;\n  }\n\n  getBottomLineY() {\n    return this.getYForLine(this.options.num_lines);\n  }\n\n  // This returns the y for the *center* of a staff line\n  getYForLine(line) {\n    const options = this.options;\n    const spacing = options.spacing_between_lines_px;\n    const headroom = options.space_above_staff_ln;\n\n    const y = this.y + (line * spacing) + (headroom * spacing);\n\n    return y;\n  }\n\n  getLineForY(y) {\n    // Does the reverse of getYForLine - somewhat dumb and just calls\n    // getYForLine until the right value is reaches\n\n    const options = this.options;\n    const spacing = options.spacing_between_lines_px;\n    const headroom = options.space_above_staff_ln;\n    return ((y - this.y) / spacing) - headroom;\n  }\n\n  getYForTopText(line) {\n    const l = line || 0;\n    return this.getYForLine(-l - this.options.top_text_position);\n  }\n\n  getYForBottomText(line) {\n    const l = line || 0;\n    return this.getYForLine(this.options.bottom_text_position + l);\n  }\n\n  getYForNote(line) {\n    const options = this.options;\n    const spacing = options.spacing_between_lines_px;\n    const headroom = options.space_above_staff_ln;\n    const y = this.y + (headroom * spacing) + (5 * spacing) - (line * spacing);\n\n    return y;\n  }\n\n  getYForGlyphs() {\n    return this.getYForLine(3);\n  }\n\n  // This method adds a stave modifier to the stave. Note that the first two\n  // modifiers (BarLines) are automatically added upon construction.\n  addModifier(modifier, position) {\n    if (position !== undefined) {\n      modifier.setPosition(position);\n    }\n\n    modifier.setStave(this);\n    this.formatted = false;\n    this.modifiers.push(modifier);\n    return this;\n  }\n\n  addEndModifier(modifier) {\n    this.addModifier(modifier, StaveModifier.Position.END);\n    return this;\n  }\n\n  // Bar Line functions\n  setBegBarType(type) {\n    // Only valid bar types at beginning of stave is none, single or begin repeat\n    const { SINGLE, REPEAT_BEGIN, NONE } = Barline.type;\n    if (type === SINGLE || type === REPEAT_BEGIN || type === NONE) {\n      this.modifiers[0].setType(type);\n      this.formatted = false;\n    }\n    return this;\n  }\n\n  setEndBarType(type) {\n    // Repeat end not valid at end of stave\n    if (type !== Barline.type.REPEAT_BEGIN) {\n      this.modifiers[1].setType(type);\n      this.formatted = false;\n    }\n    return this;\n  }\n\n  setClef(clefSpec, size, annotation, position) {\n    if (position === undefined) {\n      position = StaveModifier.Position.BEGIN;\n    }\n\n    if (position === StaveModifier.Position.END) {\n      this.endClef = clefSpec;\n    } else {\n      this.clef = clefSpec;\n    }\n\n    const clefs = this.getModifiers(position, Clef.CATEGORY);\n    if (clefs.length === 0) {\n      this.addClef(clefSpec, size, annotation, position);\n    } else {\n      clefs[0].setType(clefSpec, size, annotation);\n    }\n\n    return this;\n  }\n\n  setEndClef(clefSpec, size, annotation) {\n    this.setClef(clefSpec, size, annotation, StaveModifier.Position.END);\n    return this;\n  }\n\n  setKeySignature(keySpec, cancelKeySpec, position) {\n    if (position === undefined) {\n      position = StaveModifier.Position.BEGIN;\n    }\n\n    const keySignatures = this.getModifiers(position, KeySignature.CATEGORY);\n    if (keySignatures.length === 0) {\n      this.addKeySignature(keySpec, cancelKeySpec, position);\n    } else {\n      keySignatures[0].setKeySig(keySpec, cancelKeySpec);\n    }\n\n    return this;\n  }\n\n  setEndKeySignature(keySpec, cancelKeySpec) {\n    this.setKeySignature(keySpec, cancelKeySpec, StaveModifier.Position.END);\n    return this;\n  }\n\n  setTimeSignature(timeSpec, customPadding, position) {\n    if (position === undefined) {\n      position = StaveModifier.Position.BEGIN;\n    }\n\n    const timeSignatures = this.getModifiers(position, TimeSignature.CATEGORY);\n    if (timeSignatures.length === 0) {\n      this.addTimeSignature(timeSpec, customPadding, position);\n    } else {\n      timeSignatures[0].setTimeSig(timeSpec);\n    }\n\n    return this;\n  }\n\n  setEndTimeSignature(timeSpec, customPadding) {\n    this.setTimeSignature(timeSpec, customPadding, StaveModifier.Position.END);\n    return this;\n  }\n\n  addKeySignature(keySpec, cancelKeySpec, position) {\n    if (position === undefined) {\n      position = StaveModifier.Position.BEGIN;\n    }\n    this.addModifier(new KeySignature(keySpec, cancelKeySpec)\n      .setPosition(position), position);\n    return this;\n  }\n\n  addClef(clef, size, annotation, position) {\n    if (position === undefined || position === StaveModifier.Position.BEGIN) {\n      this.clef = clef;\n    } else if (position === StaveModifier.Position.END) {\n      this.endClef = clef;\n    }\n\n    this.addModifier(new Clef(clef, size, annotation), position);\n    return this;\n  }\n\n  addEndClef(clef, size, annotation) {\n    this.addClef(clef, size, annotation, StaveModifier.Position.END);\n    return this;\n  }\n\n  addTimeSignature(timeSpec, customPadding, position) {\n    this.addModifier(new TimeSignature(timeSpec, customPadding), position);\n    return this;\n  }\n\n  addEndTimeSignature(timeSpec, customPadding) {\n    this.addTimeSignature(timeSpec, customPadding, StaveModifier.Position.END);\n    return this;\n  }\n\n  // Deprecated\n  addTrebleGlyph() {\n    this.addClef('treble');\n    return this;\n  }\n\n  getModifiers(position, category) {\n    if (position === undefined && category === undefined) return this.modifiers;\n\n    return this.modifiers.filter(modifier =>\n      (position === undefined || position === modifier.getPosition()) &&\n      (category === undefined || category === modifier.getCategory())\n    );\n  }\n\n  sortByCategory(items, order) {\n    for (let i = items.length - 1; i >= 0; i--) {\n      for (let j = 0; j < i; j++) {\n        if (order[items[j].getCategory()] > order[items[j + 1].getCategory()]) {\n          const temp = items[j];\n          items[j] = items[j + 1];\n          items[j + 1] = temp;\n        }\n      }\n    }\n  }\n\n  format() {\n    const begBarline = this.modifiers[0];\n    const endBarline = this.modifiers[1];\n\n    const begModifiers = this.getModifiers(StaveModifier.Position.BEGIN);\n    const endModifiers = this.getModifiers(StaveModifier.Position.END);\n\n    this.sortByCategory(begModifiers, {\n      barlines: 0, clefs: 1, keysignatures: 2, timesignatures: 3,\n    });\n\n    this.sortByCategory(endModifiers, {\n      timesignatures: 0, keysignatures: 1, barlines: 2, clefs: 3,\n    });\n\n    if (begModifiers.length > 1 &&\n      begBarline.getType() === Barline.type.REPEAT_BEGIN) {\n      begModifiers.push(begModifiers.splice(0, 1)[0]);\n      begModifiers.splice(0, 0, new Barline(Barline.type.SINGLE));\n    }\n\n    if (endModifiers.indexOf(endBarline) > 0) {\n      endModifiers.splice(0, 0, new Barline(Barline.type.NONE));\n    }\n\n    let width;\n    let padding;\n    let modifier;\n    let offset = 0;\n    let x = this.x;\n    for (let i = 0; i < begModifiers.length; i++) {\n      modifier = begModifiers[i];\n      padding = modifier.getPadding(i + offset);\n      width = modifier.getWidth();\n\n      x += padding;\n      modifier.setX(x);\n      x += width;\n\n      if (padding + width === 0) offset--;\n    }\n\n    this.start_x = x;\n    x = this.x + this.width;\n\n    const widths = {\n      left: 0,\n      right: 0,\n      paddingRight: 0,\n      paddingLeft: 0,\n    };\n\n    let lastBarlineIdx = 0;\n\n    for (let i = 0; i < endModifiers.length; i++) {\n      modifier = endModifiers[i];\n      lastBarlineIdx = (modifier.getCategory() === 'barlines') ? i : lastBarlineIdx;\n\n      widths.right = 0;\n      widths.left = 0;\n      widths.paddingRight = 0;\n      widths.paddingLeft = 0;\n      const layoutMetrics = modifier.getLayoutMetrics();\n\n      if (layoutMetrics) {\n        if (i !== 0) {\n          widths.right = layoutMetrics.xMax || 0;\n          widths.paddingRight = layoutMetrics.paddingRight || 0;\n        }\n        widths.left = (-layoutMetrics.xMin) || 0;\n        widths.paddingLeft = layoutMetrics.paddingLeft || 0;\n\n        if (i === endModifiers.length - 1) {\n          widths.paddingLeft = 0;\n        }\n      } else {\n        widths.paddingRight = modifier.getPadding(i - lastBarlineIdx);\n        if (i !== 0) {\n          widths.right = modifier.getWidth();\n        }\n        if (i === 0) {\n          widths.left = modifier.getWidth();\n        }\n      }\n      x -= widths.paddingRight;\n      x -= widths.right;\n\n      modifier.setX(x);\n\n      x -= widths.left;\n      x -= widths.paddingLeft;\n    }\n\n    this.end_x = endModifiers.length === 1 ? this.x + this.width : x;\n    this.formatted = true;\n  }\n\n  /**\n   * All drawing functions below need the context to be set.\n   */\n  draw() {\n    this.checkContext();\n    this.setRendered();\n\n    if (!this.formatted) this.format();\n\n    const num_lines = this.options.num_lines;\n    const width = this.width;\n    const x = this.x;\n    let y;\n\n    // Render lines\n    for (let line = 0; line < num_lines; line++) {\n      y = this.getYForLine(line);\n\n      this.applyStyle();\n      if (this.options.line_config[line].visible) {\n        this.context.beginPath();\n        this.context.moveTo(x, y);\n        this.context.lineTo(x + width, y);\n        this.context.stroke();\n      }\n      this.restoreStyle();\n    }\n\n    // Draw the modifiers (bar lines, coda, segno, repeat brackets, etc.)\n    for (let i = 0; i < this.modifiers.length; i++) {\n      // Only draw modifier if it has a draw function\n      if (typeof this.modifiers[i].draw === 'function') {\n        this.modifiers[i].applyStyle(this.context);\n        this.modifiers[i].draw(this, this.getModifierXShift(i));\n        this.modifiers[i].restoreStyle(this.context);\n      }\n    }\n\n    // Render measure numbers\n    if (this.measure > 0) {\n      this.context.save();\n      this.context.setFont(this.font.family, this.font.size, this.font.weight);\n      const text_width = this.context.measureText('' + this.measure).width;\n      y = this.getYForTopText(0) + 3;\n      this.context.fillText('' + this.measure, this.x - text_width / 2, y);\n      this.context.restore();\n    }\n\n    return this;\n  }\n\n  // Draw Simple barlines for backward compatability\n  // Do not delete - draws the beginning bar of the stave\n  drawVertical(x, isDouble) {\n    this.drawVerticalFixed(this.x + x, isDouble);\n  }\n\n  drawVerticalFixed(x, isDouble) {\n    this.checkContext();\n\n    const top_line = this.getYForLine(0);\n    const bottom_line = this.getYForLine(this.options.num_lines - 1);\n    if (isDouble) {\n      this.context.fillRect(x - 3, top_line, 1, bottom_line - top_line + 1);\n    }\n    this.context.fillRect(x, top_line, 1, bottom_line - top_line + 1);\n  }\n\n  drawVerticalBar(x) {\n    this.drawVerticalBarFixed(this.x + x, false);\n  }\n\n  drawVerticalBarFixed(x) {\n    this.checkContext();\n\n    const top_line = this.getYForLine(0);\n    const bottom_line = this.getYForLine(this.options.num_lines - 1);\n    this.context.fillRect(x, top_line, 1, bottom_line - top_line + 1);\n  }\n\n  /**\n   * Get the current configuration for the Stave.\n   * @return {Array} An array of configuration objects.\n   */\n  getConfigForLines() {\n    return this.options.line_config;\n  }\n\n  /**\n   * Configure properties of the lines in the Stave\n   * @param line_number The index of the line to configure.\n   * @param line_config An configuration object for the specified line.\n   * @throws Vex.RERR \"StaveConfigError\" When the specified line number is out of\n   *   range of the number of lines specified in the constructor.\n   */\n  setConfigForLine(line_number, line_config) {\n    if (line_number >= this.options.num_lines || line_number < 0) {\n      throw new Vex.RERR(\n        'StaveConfigError',\n        'The line number must be within the range of the number of lines in the Stave.'\n      );\n    }\n\n    if (line_config.visible === undefined) {\n      throw new Vex.RERR(\n        'StaveConfigError',\n        \"The line configuration object is missing the 'visible' property.\"\n      );\n    }\n\n    if (typeof (line_config.visible) !== 'boolean') {\n      throw new Vex.RERR(\n        'StaveConfigError',\n        \"The line configuration objects 'visible' property must be true or false.\"\n      );\n    }\n\n    this.options.line_config[line_number] = line_config;\n\n    return this;\n  }\n\n  /**\n   * Set the staff line configuration array for all of the lines at once.\n   * @param lines_configuration An array of line configuration objects.  These objects\n   *   are of the same format as the single one passed in to setLineConfiguration().\n   *   The caller can set null for any line config entry if it is desired that the default be used\n   * @throws Vex.RERR \"StaveConfigError\" When the lines_configuration array does not have\n   *   exactly the same number of elements as the num_lines configuration object set in\n   *   the constructor.\n   */\n  setConfigForLines(lines_configuration) {\n    if (lines_configuration.length !== this.options.num_lines) {\n      throw new Vex.RERR(\n        'StaveConfigError',\n        'The length of the lines configuration array must match the number of lines in the Stave'\n      );\n    }\n\n    // Make sure the defaults are present in case an incomplete set of\n    //  configuration options were supplied.\n    // eslint-disable-next-line\n    for (const line_config in lines_configuration) {\n      // Allow 'null' to be used if the caller just wants the default for a particular node.\n      if (!lines_configuration[line_config]) {\n        lines_configuration[line_config] = this.options.line_config[line_config];\n      }\n      Vex.Merge(this.options.line_config[line_config], lines_configuration[line_config]);\n    }\n\n    this.options.line_config = lines_configuration;\n\n    return this;\n  }\n}\n"],"file":"stave.js"}