{"version":3,"sources":["../../../node_modules/vexflow/src/staveline.js"],"names":["drawArrowHead","ctx","x0","y0","x1","y1","x2","y2","beginPath","moveTo","lineTo","closePath","fill","drawArrowLine","point1","point2","config","both_arrows","draw_start_arrow","draw_end_arrow","x","y","distance","Math","sqrt","ratio","arrowhead_length","end_x","end_y","start_x","start_y","round","color","setStrokeStyle","setFillStyle","stroke","line_angle","atan2","h","abs","cos","arrowhead_angle","angle1","angle2","top_x","top_y","bottom_x","bottom_y","PI","sin","StaveLine","Element","TextVerticalPosition","TOP","BOTTOM","TextJustification","LEFT","CENTER","RIGHT","constructor","notes","setAttribute","text","font","family","size","weight","render_options","padding_left","padding_right","line_width","line_dash","rounded_end","text_position_vertical","text_justification","setNotes","setFont","setText","first_note","last_note","Vex","RuntimeError","first_indices","last_indices","length","applyLineStyle","checkContext","setLineDash","setLineWidth","setLineCap","applyFontStyle","draw","setRendered","save","start_position","end_position","forEach","first_index","i","last_index","getModifierStartXY","upwards_slope","getMetrics","modRightPx","modLeftPx","notehead_width","getGlyph","getWidth","first_displaced","getKeyProps","displaced","getStemDirection","last_displaced","restore","text_width","measureText","width","justification","delta_x","center_x","vertical_position","getStave","getYForTopText","getYForBottomText","Flow","TEXT_HEIGHT_OFFSET_HACK","fillText"],"mappings":"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","sourcesContent":["// [VexFlow](http://vexflow.com) - Copyright (c) Mohit Muthanna 2010.\n//\n// ## Description\n//\n// This file implements `StaveLine` which are simply lines that connect\n// two notes. This object is highly configurable, see the `render_options`.\n// A simple line is often used for notating glissando articulations, but you\n// can format a `StaveLine` with arrows or colors for more pedagogical\n// purposes, such as diagrams.\nimport { Vex } from './vex';\nimport { Element } from './element';\nimport { Flow } from './tables';\n\n// Attribution: Arrow rendering implementations based off of\n// Patrick Horgan's article, \"Drawing lines and arcs with\n// arrow heads on  HTML5 Canvas\"\n//\n// Draw an arrow head that connects between 3 coordinates\nfunction drawArrowHead(ctx, x0, y0, x1, y1, x2, y2) {\n  // all cases do this.\n  ctx.beginPath();\n  ctx.moveTo(x0, y0);\n  ctx.lineTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.lineTo(x0, y0);\n  ctx.closePath();\n\n  ctx.fill();\n}\n\n// Helper function to draw a line with arrow heads\nfunction drawArrowLine(ctx, point1, point2, config) {\n  const both_arrows = config.draw_start_arrow && config.draw_end_arrow;\n\n  const x1 = point1.x;\n  const y1 = point1.y;\n  const x2 = point2.x;\n  const y2 = point2.y;\n\n  // For ends with arrow we actually want to stop before we get to the arrow\n  // so that wide lines won't put a flat end on the arrow.\n  const distance = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  const ratio = (distance - config.arrowhead_length / 3) / distance;\n  let end_x;\n  let end_y;\n  let start_x;\n  let start_y;\n  if (config.draw_end_arrow || both_arrows) {\n    end_x = Math.round(x1 + (x2 - x1) * ratio);\n    end_y = Math.round(y1 + (y2 - y1) * ratio);\n  } else {\n    end_x = x2;\n    end_y = y2;\n  }\n\n  if (config.draw_start_arrow || both_arrows) {\n    start_x = x1 + (x2 - x1) * (1 - ratio);\n    start_y = y1 + (y2 - y1) * (1 - ratio);\n  } else {\n    start_x = x1;\n    start_y = y1;\n  }\n\n  if (config.color) {\n    ctx.setStrokeStyle(config.color);\n    ctx.setFillStyle(config.color);\n  }\n\n  // Draw the shaft of the arrow\n  ctx.beginPath();\n  ctx.moveTo(start_x, start_y);\n  ctx.lineTo(end_x, end_y);\n  ctx.stroke();\n  ctx.closePath();\n\n  // calculate the angle of the line\n  const line_angle = Math.atan2(y2 - y1, x2 - x1);\n  // h is the line length of a side of the arrow head\n  const h = Math.abs(config.arrowhead_length / Math.cos(config.arrowhead_angle));\n\n  let angle1;\n  let angle2;\n  let top_x;\n  let top_y;\n  let bottom_x;\n  let bottom_y;\n\n  if (config.draw_end_arrow || both_arrows) {\n    angle1 = line_angle + Math.PI + config.arrowhead_angle;\n    top_x = x2 + Math.cos(angle1) * h;\n    top_y = y2 + Math.sin(angle1) * h;\n\n    angle2 = line_angle + Math.PI - config.arrowhead_angle;\n    bottom_x = x2 + Math.cos(angle2) * h;\n    bottom_y = y2 + Math.sin(angle2) * h;\n\n    drawArrowHead(ctx, top_x, top_y, x2, y2, bottom_x, bottom_y);\n  }\n\n  if (config.draw_start_arrow || both_arrows) {\n    angle1 = line_angle + config.arrowhead_angle;\n    top_x = x1 + Math.cos(angle1) * h;\n    top_y = y1 + Math.sin(angle1) * h;\n\n    angle2 = line_angle - config.arrowhead_angle;\n    bottom_x = x1 + Math.cos(angle2) * h;\n    bottom_y = y1 + Math.sin(angle2) * h;\n\n    drawArrowHead(ctx, top_x, top_y, x1, y1, bottom_x, bottom_y);\n  }\n}\n\nexport class StaveLine extends Element {\n  // Text Positioning\n  static get TextVerticalPosition() {\n    return {\n      TOP: 1,\n      BOTTOM: 2,\n    };\n  }\n\n  static get TextJustification() {\n    return {\n      LEFT: 1,\n      CENTER: 2,\n      RIGHT: 3,\n    };\n  }\n\n  // Initialize the StaveLine with the given `notes`.\n  //\n  // `notes` is a struct that has:\n  //\n  //  ```\n  //  {\n  //    first_note: Note,\n  //    last_note: Note,\n  //    first_indices: [n1, n2, n3],\n  //    last_indices: [n1, n2, n3]\n  //  }\n  //  ```\n  constructor(notes) {\n    super();\n    this.setAttribute('type', 'StaveLine');\n\n    this.notes = notes;\n\n    this.text = '';\n\n    this.font = {\n      family: 'Arial',\n      size: 10,\n      weight: '',\n    };\n\n    this.render_options = {\n      // Space to add to the left or the right\n      padding_left: 4,\n      padding_right: 3,\n\n      // The width of the line in pixels\n      line_width: 1,\n      // An array of line/space lengths. Unsupported with Raphael (SVG)\n      line_dash: null,\n      // Can draw rounded line end, instead of a square. Unsupported with Raphael (SVG)\n      rounded_end: true,\n      // The color of the line and arrowheads\n      color: null,\n\n      // Flags to draw arrows on each end of the line\n      draw_start_arrow: false,\n      draw_end_arrow: false,\n\n      // The length of the arrowhead sides\n      arrowhead_length: 10,\n      // The angle of the arrowhead\n      arrowhead_angle: Math.PI / 8,\n\n      // The position of the text\n      text_position_vertical: StaveLine.TextVerticalPosition.TOP,\n      text_justification: StaveLine.TextJustification.CENTER,\n    };\n\n    this.setNotes(notes);\n  }\n\n  // Set the font for the `StaveLine` text\n  setFont(font) { this.font = font; return this; }\n  // The the annotation for the `StaveLine`\n  setText(text) { this.text = text; return this; }\n\n  // Set the notes for the `StaveLine`\n  setNotes(notes) {\n    if (!notes.first_note && !notes.last_note) {\n      throw new Vex.RuntimeError(\n        'BadArguments', 'Notes needs to have either first_note or last_note set.'\n      );\n    }\n\n    if (!notes.first_indices) notes.first_indices = [0];\n    if (!notes.last_indices) notes.last_indices = [0];\n\n    if (notes.first_indices.length !== notes.last_indices.length) {\n      throw new Vex.RuntimeError(\n        'BadArguments', 'Connected notes must have similar index sizes'\n      );\n    }\n\n    // Success. Lets grab 'em notes.\n    this.first_note = notes.first_note;\n    this.first_indices = notes.first_indices;\n    this.last_note = notes.last_note;\n    this.last_indices = notes.last_indices;\n    return this;\n  }\n\n  // Apply the style of the `StaveLine` to the context\n  applyLineStyle() {\n    const ctx = this.checkContext();\n    const render_options = this.render_options;\n\n    if (render_options.line_dash) {\n      ctx.setLineDash(render_options.line_dash);\n    }\n\n    if (render_options.line_width) {\n      ctx.setLineWidth(render_options.line_width);\n    }\n\n    if (render_options.rounded_end) {\n      ctx.setLineCap('round');\n    } else {\n      ctx.setLineCap('square');\n    }\n  }\n\n  // Apply the text styling to the context\n  applyFontStyle() {\n    const ctx = this.checkContext();\n\n    if (this.font) {\n      ctx.setFont(this.font.family, this.font.size, this.font.weight);\n    }\n\n    if (this.render_options.color) {\n      ctx.setStrokeStyle(this.render_options.color);\n      ctx.setFillStyle(this.render_options.color);\n    }\n  }\n\n  // Renders the `StaveLine` on the context\n  draw() {\n    const ctx = this.checkContext();\n    this.setRendered();\n\n    const first_note = this.first_note;\n    const last_note = this.last_note;\n    const render_options = this.render_options;\n\n    ctx.save();\n    this.applyLineStyle();\n\n    // Cycle through each set of indices and draw lines\n    let start_position;\n    let end_position;\n    this.first_indices.forEach((first_index, i) => {\n      const last_index = this.last_indices[i];\n\n      // Get initial coordinates for the start/end of the line\n      start_position = first_note.getModifierStartXY(2, first_index);\n      end_position = last_note.getModifierStartXY(1, last_index);\n      const upwards_slope = start_position.y > end_position.y;\n\n      // Adjust `x` coordinates for modifiers\n      start_position.x += first_note.getMetrics().modRightPx + render_options.padding_left;\n      end_position.x -= last_note.getMetrics().modLeftPx + render_options.padding_right;\n\n\n      // Adjust first `x` coordinates for displacements\n      const notehead_width = first_note.getGlyph().getWidth();\n      const first_displaced = first_note.getKeyProps()[first_index].displaced;\n      if (first_displaced && first_note.getStemDirection() === 1) {\n        start_position.x += notehead_width + render_options.padding_left;\n      }\n\n      // Adjust last `x` coordinates for displacements\n      const last_displaced = last_note.getKeyProps()[last_index].displaced;\n      if (last_displaced && last_note.getStemDirection() === -1) {\n        end_position.x -= notehead_width + render_options.padding_right;\n      }\n\n      // Adjust y position better if it's not coming from the center of the note\n      start_position.y += upwards_slope ? -3 : 1;\n      end_position.y += upwards_slope ? 2 : 0;\n\n      drawArrowLine(ctx, start_position, end_position, this.render_options);\n    });\n\n    ctx.restore();\n\n    // Determine the x coordinate where to start the text\n    const text_width = ctx.measureText(this.text).width;\n    const justification = render_options.text_justification;\n    let x = 0;\n    if (justification === StaveLine.TextJustification.LEFT) {\n      x = start_position.x;\n    } else if (justification === StaveLine.TextJustification.CENTER) {\n      const delta_x = (end_position.x - start_position.x);\n      const center_x = (delta_x / 2) + start_position.x;\n      x = center_x - (text_width / 2);\n    } else if (justification === StaveLine.TextJustification.RIGHT) {\n      x = end_position.x  -  text_width;\n    }\n\n    // Determine the y value to start the text\n    let y;\n    const vertical_position = render_options.text_position_vertical;\n    if (vertical_position === StaveLine.TextVerticalPosition.TOP) {\n      y = first_note.getStave().getYForTopText();\n    } else if (vertical_position === StaveLine.TextVerticalPosition.BOTTOM) {\n      y = first_note.getStave().getYForBottomText(Flow.TEXT_HEIGHT_OFFSET_HACK);\n    }\n\n    // Draw the text\n    ctx.save();\n    this.applyFontStyle();\n    ctx.fillText(this.text, x, y);\n    ctx.restore();\n\n    return this;\n  }\n}\n"],"file":"staveline.js"}