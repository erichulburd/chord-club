{"version":3,"sources":["../../../node_modules/vexflow/src/gracenotegroup.js"],"names":["L","args","GraceNoteGroup","DEBUG","Vex","Modifier","CATEGORY","format","gracenote_groups","state","group_spacing_stave","group_spacing_tab","length","group_list","prev_note","shiftL","i","gracenote_group","note","getNote","is_stavenote","getCategory","StaveNote","spacing","n","keys","Math","max","getLeftDisplacedHeadPx","push","shift","group_shift","formatWidth","preFormat","getWidth","setSpacingFromNextModifier","min","left_shift","constructor","grace_notes","show_slur","setAttribute","index","position","Position","LEFT","width","preFormatted","slur","formatter","Formatter","voice","Voice","num_beats","beat_value","resolution","Flow","RESOLUTION","setStrict","render_options","slur_y_shift","beams","addTickables","joinVoices","setWidth","getMinTotalWidth","beamNotes","beam","Beam","beam_width","partial_beam_length","setNote","getGraceNotes","draw","checkContext","RuntimeError","setRendered","alignSubNotesWithNote","forEach","graceNote","setContext","context","TieClass","StaveTie","TabTie","last_note","first_note","first_indices","last_indices","cp2","y_shift"],"mappings":"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","sourcesContent":["// [VexFlow](http://vexflow.com) - Copyright (c) Mohit Muthanna 2010.\n//\n// ## Description\n//\n// This file implements `GraceNoteGroup` which is used to format and\n// render grace notes.\n\nimport { Vex } from './vex';\nimport { Flow } from './tables';\nimport { Modifier } from './modifier';\nimport { Formatter } from './formatter';\nimport { Voice } from './voice';\nimport { Beam } from './beam';\nimport { StaveTie } from './stavetie';\nimport { TabTie } from './tabtie';\nimport { StaveNote } from './stavenote';\n\n// To enable logging for this class. Set `Vex.Flow.GraceNoteGroup.DEBUG` to `true`.\nfunction L(...args) { if (GraceNoteGroup.DEBUG) Vex.L('Vex.Flow.GraceNoteGroup', args); }\n\nexport class GraceNoteGroup extends Modifier {\n  static get CATEGORY() { return 'gracenotegroups'; }\n\n  // Arrange groups inside a `ModifierContext`\n  static format(gracenote_groups, state) {\n    const group_spacing_stave = 4;\n    const group_spacing_tab = 0;\n\n    if (!gracenote_groups || gracenote_groups.length === 0) return false;\n\n    const group_list = [];\n    let prev_note = null;\n    let shiftL = 0;\n\n    for (let i = 0; i < gracenote_groups.length; ++i) {\n      const gracenote_group = gracenote_groups[i];\n      const note = gracenote_group.getNote();\n      const is_stavenote = (note.getCategory() === StaveNote.CATEGORY);\n      const spacing = (is_stavenote ? group_spacing_stave : group_spacing_tab);\n\n      if (is_stavenote && note !== prev_note) {\n        // Iterate through all notes to get the displaced pixels\n        for (let n = 0; n < note.keys.length; ++n) {\n          shiftL = Math.max(note.getLeftDisplacedHeadPx(), shiftL);\n        }\n        prev_note = note;\n      }\n\n      group_list.push({ shift: shiftL, gracenote_group, spacing });\n    }\n\n    // If first note left shift in case it is displaced\n    let group_shift = group_list[0].shift;\n    let formatWidth;\n    for (let i = 0; i < group_list.length; ++i) {\n      const gracenote_group = group_list[i].gracenote_group;\n      gracenote_group.preFormat();\n      formatWidth = gracenote_group.getWidth() + group_list[i].spacing;\n      group_shift = Math.max(formatWidth, group_shift);\n    }\n\n    for (let i = 0; i < group_list.length; ++i) {\n      const gracenote_group = group_list[i].gracenote_group;\n      formatWidth = gracenote_group.getWidth() + group_list[i].spacing;\n      gracenote_group.setSpacingFromNextModifier(group_shift - Math.min(formatWidth, group_shift));\n    }\n\n    state.left_shift += group_shift;\n    return true;\n  }\n\n  // ## Prototype Methods\n  //\n  // `GraceNoteGroup` inherits from `Modifier` and is placed inside a\n  // `ModifierContext`.\n  constructor(grace_notes, show_slur) {\n    super();\n    this.setAttribute('type', 'GraceNoteGroup');\n\n    this.note = null;\n    this.index = null;\n    this.position = Modifier.Position.LEFT;\n    this.grace_notes = grace_notes;\n    this.width = 0;\n\n    this.preFormatted = false;\n\n    this.show_slur = show_slur;\n    this.slur = null;\n\n    this.formatter = new Formatter();\n    this.voice = new Voice({\n      num_beats: 4,\n      beat_value: 4,\n      resolution: Flow.RESOLUTION,\n    }).setStrict(false);\n\n    this.render_options = {\n      slur_y_shift: 0,\n    };\n\n    this.beams = [];\n\n    this.voice.addTickables(this.grace_notes);\n\n    return this;\n  }\n\n  getCategory() { return GraceNoteGroup.CATEGORY; }\n\n  preFormat() {\n    if (this.preFormatted) return;\n\n    this.formatter.joinVoices([this.voice]).format([this.voice], 0);\n    this.setWidth(this.formatter.getMinTotalWidth());\n    this.preFormatted = true;\n  }\n\n  beamNotes(grace_notes) {\n    grace_notes = grace_notes || this.grace_notes;\n    if (grace_notes.length > 1) {\n      const beam = new Beam(grace_notes);\n\n      beam.render_options.beam_width = 3;\n      beam.render_options.partial_beam_length = 4;\n\n      this.beams.push(beam);\n    }\n\n    return this;\n  }\n\n  setNote(note) {\n    this.note = note;\n  }\n  setWidth(width) {\n    this.width = width;\n  }\n  getWidth() {\n    return this.width;\n  }\n  getGraceNotes() {\n    return this.grace_notes;\n  }\n  draw() {\n    this.checkContext();\n\n    const note = this.getNote();\n\n    L('Drawing grace note group for:', note);\n\n    if (!(note && (this.index !== null))) {\n      throw new Vex.RuntimeError('NoAttachedNote',\n        \"Can't draw grace note without a parent note and parent note index.\");\n    }\n\n    this.setRendered();\n    this.alignSubNotesWithNote(this.getGraceNotes(), note); // Modifier function\n\n    // Draw notes\n    this.grace_notes.forEach(graceNote => {\n      graceNote.setContext(this.context).draw();\n    });\n\n    // Draw beam\n    this.beams.forEach(beam => {\n      beam.setContext(this.context).draw();\n    });\n\n    if (this.show_slur) {\n      // Create and draw slur\n      const is_stavenote = (this.getNote().getCategory() === StaveNote.CATEGORY);\n      const TieClass = (is_stavenote ? StaveTie : TabTie);\n\n      this.slur = new TieClass({\n        last_note: this.grace_notes[0],\n        first_note: note,\n        first_indices: [0],\n        last_indices: [0],\n      });\n\n      this.slur.render_options.cp2 = 12;\n      this.slur.render_options.y_shift = (is_stavenote ? 7 : 5) + this.render_options.slur_y_shift;\n      this.slur.setContext(this.context).draw();\n    }\n  }\n}\n"],"file":"gracenotegroup.js"}