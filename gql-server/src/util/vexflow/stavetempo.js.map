{"version":3,"sources":["../../../node_modules/vexflow/src/stavetempo.js"],"names":["StaveTempo","StaveModifier","CATEGORY","constructor","tempo","x","shift_y","setAttribute","position","Modifier","Position","ABOVE","shift_x","font","family","size","weight","render_options","glyph_font_scale","getCategory","setTempo","setShiftX","setShiftY","y","draw","stave","ctx","checkContext","setRendered","options","scale","name","duration","dots","bpm","getYForTopText","save","setFont","fillText","measureText","width","code","Flow","getGlyphProps","Glyph","renderGlyph","code_head","getWidth","stem","stem_height","beam_count","y_top","fillRect","flag","code_flag_upstem","category","i","beginPath","arc","Math","PI","fill","restore"],"mappings":"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","sourcesContent":["// [VexFlow](http://vexflow.com) - Copyright (c) Mohit Muthanna 2010.\n// Author Radosaw Eichler 2012\n\nimport { Flow } from './tables';\nimport { Modifier } from './modifier';\nimport { StaveModifier } from './stavemodifier';\nimport { Glyph } from './glyph';\n\nexport class StaveTempo extends StaveModifier {\n  static get CATEGORY() { return 'stavetempo'; }\n\n  constructor(tempo, x, shift_y) {\n    super();\n    this.setAttribute('type', 'StaveTempo');\n\n    this.tempo = tempo;\n    this.position = Modifier.Position.ABOVE;\n    this.x = x;\n    this.shift_x = 10;\n    this.shift_y = shift_y;\n    this.font = {\n      family: 'times',\n      size: 14,\n      weight: 'bold',\n    };\n    this.render_options = {\n      glyph_font_scale: 30,  // font size for note\n    };\n  }\n  getCategory() { return StaveTempo.CATEGORY; }\n  setTempo(tempo) { this.tempo = tempo; return this; }\n  setShiftX(x) { this.shift_x = x; return this; }\n  setShiftY(y) { this.shift_y = y; return this; }\n\n  draw(stave, shift_x) {\n    const ctx = stave.checkContext();\n    this.setRendered();\n\n    const options = this.render_options;\n    // FIXME: What does the '38' mean? Why 38? Is that supposed to\n    // be the default font size for standard notation?\n    const scale = options.glyph_font_scale / 38;\n    const name = this.tempo.name;\n    const duration = this.tempo.duration;\n    const dots = this.tempo.dots;\n    const bpm = this.tempo.bpm;\n    const font = this.font;\n    let x = this.x + this.shift_x + shift_x;\n    const y = stave.getYForTopText(1) + this.shift_y;\n\n    ctx.save();\n\n    if (name) {\n      ctx.setFont(font.family, font.size, font.weight);\n      ctx.fillText(name, x, y);\n      x += ctx.measureText(name).width;\n    }\n\n    if (duration && bpm) {\n      ctx.setFont(font.family, font.size, 'normal');\n\n      if (name) {\n        x += ctx.measureText(' ').width;\n        ctx.fillText('(', x, y);\n        x += ctx.measureText('(').width;\n      }\n\n      const code = Flow.getGlyphProps(duration);\n\n      x += 3 * scale;\n      Glyph.renderGlyph(ctx, x, y, options.glyph_font_scale, code.code_head);\n      x += code.getWidth() * scale;\n\n      // Draw stem and flags\n      if (code.stem) {\n        let stem_height = 30;\n\n        if (code.beam_count) stem_height += 3 * (code.beam_count - 1);\n\n        stem_height *= scale;\n\n        const y_top = y - stem_height;\n        ctx.fillRect(x - scale, y_top, scale, stem_height);\n\n        if (code.flag) {\n          Glyph.renderGlyph(ctx, x, y_top, options.glyph_font_scale,\n            code.code_flag_upstem, { category: 'flag.staveTempo' });\n\n          if (!dots) x += 6 * scale;\n        }\n      }\n\n      // Draw dot\n      for (let i = 0; i < dots; i++) {\n        x += 6 * scale;\n        ctx.beginPath();\n        ctx.arc(x, y + 2 * scale, 2 * scale, 0, Math.PI * 2, false);\n        ctx.fill();\n      }\n\n      ctx.fillText(' = ' + bpm + (name ? ')' : ''), x + 3 * scale, y);\n    }\n\n    ctx.restore();\n    return this;\n  }\n}\n"],"file":"stavetempo.js"}